{"remainingRequest":"E:\\Notes_Sharing Study System\\note-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Notes_Sharing Study System\\note-front\\src\\views\\notes\\childrens\\NoteCommentContainer.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\Notes_Sharing Study System\\note-front\\src\\views\\notes\\childrens\\NoteCommentContainer.vue","mtime":1672661779644},{"path":"E:\\Notes_Sharing Study System\\note-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Notes_Sharing Study System\\note-front\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\Notes_Sharing Study System\\note-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Notes_Sharing Study System\\note-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCBOb3RlQ29tbWVudExpc3QgZnJvbSAiLi9Ob3RlQ29tbWVudExpc3QudnVlIjsKaW1wb3J0IHsKICBnZXRDb21tZW50QnlOb3RlSWQsCiAgZ2V0Q29tbWVudExpa2VSZWxhdGlvbiwKICBzYXZlQ29tbWVudCwKfSBmcm9tICJAL25ldHdvcmsvbm90ZS9pbmRleC5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgY29tbWVudENvbnRlbnQ6ICIiLAogICAgICBjb21tZW50RGF0YTogW10sCiAgICAgIGxpa2VSZWxhdGlvbjogW10sCiAgICAgIGlzUmVwbHk6IGZhbHNlLAogICAgICBjdXJyZW50UmVwbHlEYXRhOiB7fSwKICAgIH07CiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXREYXRhKCk7CiAgfSwKICBjb21wdXRlZDogewogICAgLy8g5qC55o2u6K+E6K66aWTljrvljLnphY3lr7nlupTnmoRsaWtlCiAgICBnZXRMaWtlRGF0YSgpIHsKICAgICAgaWYgKCF0aGlzLmxpa2VSZWxhdGlvbikgcmV0dXJuICgpID0+ICh7fSk7CiAgICAgIHJldHVybiAoaXRlbSkgPT4gewogICAgICAgIHJldHVybiB0aGlzLmxpa2VSZWxhdGlvbi5maW5kKChsaWtlSXRlbSkgPT4gbGlrZUl0ZW0uaWQgPT09IGl0ZW0uaWQpOwogICAgICB9OwogICAgfSwKICAgIHJlcGx5UGxhY2Vob2xkZXIoKSB7CiAgICAgIHJldHVybiB0aGlzLmlzUmVwbHkKICAgICAgICA/IGBSZXBseSBAJHt0aGlzLmN1cnJlbnRSZXBseURhdGEudXNlck5hbWV9YAogICAgICAgIDogIlBvc3QgQSBGcmllbmRseSBDb21tZW50IjsKICAgIH0sCiAgICBpc0xvZ2luKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlckluZm87CiAgICB9LAogICAgY3VycmVudFVzZXJBdmF0YXIoKSB7CiAgICAgIGlmICghdGhpcy4kc3RvcmUuc3RhdGUudXNlckluZm8pCiAgICAgICAgcmV0dXJuICJodHRwczovL2N1YmUuZWxlbWVjZG4uY29tLzAvODgvMDNiMGQzOTU4M2Y0ODIwNjc2OGE3NTM0ZTU1YmNwbmcucG5nIjsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJJbmZvLmF2YXRhclVybDsKICAgIH0sCiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBnZXREYXRhKCkgewogICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGdldENvbW1lbnRCeU5vdGVJZCh0aGlzLiRyb3V0ZS5xdWVyeS5pZCk7CiAgICAgIHRoaXMuY29tbWVudERhdGEgPSBkYXRhOwogICAgICBjb25zdCB7IGRhdGE6IHJlbGF0aW9uRGF0YSB9ID0gYXdhaXQgdGhpcy5nZXRMaWtlUmVsYXRpb24oKTsKICAgICAgdGhpcy5saWtlUmVsYXRpb24gPSByZWxhdGlvbkRhdGE7CiAgICB9LAogICAgZ2V0TGlrZVJlbGF0aW9uKCkgewogICAgICByZXR1cm4gZ2V0Q29tbWVudExpa2VSZWxhdGlvbigKICAgICAgICB0aGlzLiRzdG9yZS5zdGF0ZS51c2VySW5mby51c2VyaWQsCiAgICAgICAgdGhpcy4kcm91dGUucXVlcnkuaWQKICAgICAgKTsKICAgIH0sCiAgICBwb3N0Q29tbWVudCgpIHsKICAgICAgbGV0IGNvbW1lbnREYXRhID0gewogICAgICAgIHVzZXJJZDogdGhpcy4kc3RvcmUuc3RhdGUudXNlckluZm8udXNlcmlkLAogICAgICAgIGNvbW1lbnRDb250ZW50OiB0aGlzLmNvbW1lbnRDb250ZW50LAogICAgICAgIG5vdGVJZDogdGhpcy4kcm91dGUucXVlcnkuaWQsCiAgICAgIH07CiAgICAgIGlmICh0aGlzLmNvbW1lbnRDb250ZW50Lmxlbmd0aCA+IDEzMCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygiVGhlIGxlbmd0aCBvZiB0aGUgY29tbWVudCBjb250ZW50IGNhbm5vdCBleGNlZWQgMTMwIGNoYXJhY3RlcnMiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY29tbWVudENvbnRlbnQudHJpbSgpLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCJDYW5ub3QgcG9zdCBibGFuayBjb250ZW50Iik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLmlzUmVwbHkpIHsKICAgICAgICBjb21tZW50RGF0YS5wYXJlbnRJZCA9CiAgICAgICAgICB0aGlzLmN1cnJlbnRSZXBseURhdGEucGFyZW50SWQgPT0gMAogICAgICAgICAgICA/IHRoaXMuY3VycmVudFJlcGx5RGF0YS5pZAogICAgICAgICAgICA6IHRoaXMuY3VycmVudFJlcGx5RGF0YS5wYXJlbnRJZDsKICAgICAgICBjb21tZW50RGF0YS5yZXBseUlkID0gdGhpcy5jdXJyZW50UmVwbHlEYXRhLmlkOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbW1lbnREYXRhLnBhcmVudElkID0gMDsKICAgICAgICBjb21tZW50RGF0YS5yZXBseUlkID0gMDsKICAgICAgfQogICAgICBjb25zb2xlLmxvZyhjb21tZW50RGF0YSk7CiAgICAgIHNhdmVDb21tZW50KGNvbW1lbnREYXRhKS50aGVuKCgpID0+IHsKICAgICAgICB0aGlzLmlzUmVwbHkgPSBmYWxzZTsKICAgICAgICB0aGlzLmNvbW1lbnRDb250ZW50ID0gIiI7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCJQb3N0IGEgY29tbWVudCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICB0aGlzLmdldERhdGEoKTsKICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgcmVsb2FkTGlrZURhdGEoKSB7CiAgICAgIGNvbnN0IHsgZGF0YTogcmVsYXRpb25EYXRhIH0gPSBhd2FpdCB0aGlzLmdldExpa2VSZWxhdGlvbigpOwogICAgICByZWxhdGlvbkRhdGEuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsKICAgICAgICB0aGlzLiRzZXQodGhpcy5saWtlUmVsYXRpb24sIGluZGV4LCBpdGVtKTsKICAgICAgfSk7CiAgICB9LAogICAgcmVwbHlVc2VyKHJlcGx5Q29tbWVudERhdGEpIHsKICAgICAgaWYgKHRoaXMuY29tbWVudENvbnRlbnQpIHRoaXMuY29tbWVudENvbnRlbnQgPSAiIjsKICAgICAgdGhpcy5jdXJyZW50UmVwbHlEYXRhID0gcmVwbHlDb21tZW50RGF0YTsKICAgICAgdGhpcy5pc1JlcGx5ID0gdHJ1ZTsKICAgICAgdGhpcy4kcmVmcy5wb3N0Q29tbWVudElucHV0UmVmLmZvY3VzKCk7CiAgICB9LAogIH0sCiAgY29tcG9uZW50czogeyBOb3RlQ29tbWVudExpc3QgfSwKfTsK"},{"version":3,"sources":["NoteCommentContainer.vue"],"names":[],"mappings":";AA0CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"NoteCommentContainer.vue","sourceRoot":"src/views/notes/childrens","sourcesContent":["<template>\n  <div class=\"comment-container\">\n    <div class=\"self-comment\" v-if=\"isLogin\">\n      <div>\n        <el-avatar :size=\"60\" :src=\"currentUserAvatar\"> </el-avatar>\n      </div>\n      <div style=\"width: 60%\">\n        <el-input\n          ref=\"postCommentInputRef\"\n          :placeholder=\"replyPlaceholder\"\n          v-model=\"commentContent\"\n        >\n        </el-input>\n      </div>\n      <div>\n        <el-button type=\"primary\" size=\"medium\" @click=\"postComment\"\n          >Post Comment</el-button\n        >\n      </div>\n    </div>\n    <div v-else class=\"login-tip\">\n      <el-link type=\"primary\" :underline=\"false\" href=\"/login\"\n        >Only after logging in can you comment, click me to jump to the login page</el-link\n      >\n    </div>\n    <div class=\"comments\">\n      <div v-if=\"commentData.length != 0\">\n        <NoteCommentList\n          v-for=\"(item, index) in commentData\"\n          :key=\"index\"\n          :listData=\"item\"\n          :likeData=\"getLikeData(item)\"\n          @reloadLikeData=\"reloadLikeData\"\n          @replyUser=\"replyUser\"\n        />\n      </div>\n      <div v-else style=\"text-align: center\">There are no comments under the current notes~</div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport NoteCommentList from \"./NoteCommentList.vue\";\nimport {\n  getCommentByNoteId,\n  getCommentLikeRelation,\n  saveComment,\n} from \"@/network/note/index.js\";\nexport default {\n  data() {\n    return {\n      commentContent: \"\",\n      commentData: [],\n      likeRelation: [],\n      isReply: false,\n      currentReplyData: {},\n    };\n  },\n  created() {\n    this.getData();\n  },\n  computed: {\n    // 根据评论id去匹配对应的like\n    getLikeData() {\n      if (!this.likeRelation) return () => ({});\n      return (item) => {\n        return this.likeRelation.find((likeItem) => likeItem.id === item.id);\n      };\n    },\n    replyPlaceholder() {\n      return this.isReply\n        ? `Reply @${this.currentReplyData.userName}`\n        : \"Post A Friendly Comment\";\n    },\n    isLogin() {\n      return this.$store.state.userInfo;\n    },\n    currentUserAvatar() {\n      if (!this.$store.state.userInfo)\n        return \"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png\";\n      return this.$store.state.userInfo.avatarUrl;\n    },\n  },\n  methods: {\n    async getData() {\n      const { data } = await getCommentByNoteId(this.$route.query.id);\n      this.commentData = data;\n      const { data: relationData } = await this.getLikeRelation();\n      this.likeRelation = relationData;\n    },\n    getLikeRelation() {\n      return getCommentLikeRelation(\n        this.$store.state.userInfo.userid,\n        this.$route.query.id\n      );\n    },\n    postComment() {\n      let commentData = {\n        userId: this.$store.state.userInfo.userid,\n        commentContent: this.commentContent,\n        noteId: this.$route.query.id,\n      };\n      if (this.commentContent.length > 130) {\n        this.$message.warning(\"The length of the comment content cannot exceed 130 characters\");\n        return;\n      }\n      if (this.commentContent.trim().length == 0) {\n        this.$message.warning(\"Cannot post blank content\");\n        return;\n      }\n      if (this.isReply) {\n        commentData.parentId =\n          this.currentReplyData.parentId == 0\n            ? this.currentReplyData.id\n            : this.currentReplyData.parentId;\n        commentData.replyId = this.currentReplyData.id;\n      } else {\n        commentData.parentId = 0;\n        commentData.replyId = 0;\n      }\n      console.log(commentData);\n      saveComment(commentData).then(() => {\n        this.isReply = false;\n        this.commentContent = \"\";\n        this.$message.success(\"Post a comment successfully\");\n        this.getData();\n      });\n    },\n    async reloadLikeData() {\n      const { data: relationData } = await this.getLikeRelation();\n      relationData.forEach((item, index) => {\n        this.$set(this.likeRelation, index, item);\n      });\n    },\n    replyUser(replyCommentData) {\n      if (this.commentContent) this.commentContent = \"\";\n      this.currentReplyData = replyCommentData;\n      this.isReply = true;\n      this.$refs.postCommentInputRef.focus();\n    },\n  },\n  components: { NoteCommentList },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.comment-container {\n  padding: 40px 20px;\n  .self-comment {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 15px;\n  }\n  .login-tip {\n    height: 30px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  .comments {\n    border-top: 1px solid #d9d9da;\n    padding-top: 40px;\n    margin-left: 30px;\n  }\n}\n</style>\n"]}]}